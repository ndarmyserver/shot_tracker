<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Shot Tracker</title>
  <!-- App name -->
  <meta name="apple-mobile-web-app-title" content="Shot Tracker">
  <!-- Make it open fullscreen, hide Safari UI -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- Status bar style (options: default, black, black-translucent)-->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Apple standard icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76.png">
  <!-- Standard favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16.png">
  <!-- Chrome pinned tab/shortcut icon -->
  <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
  <!-- Safari pinned tab icon -->
  <link rel="mask-icon" href="/icons/safari-icon.svg" color="#000000">
  <!-- Launch screen color on iOS -->
  <meta name="theme-color" content="#151515">

  <!-- <link rel="stylesheet" href="styles.css" /> -->
  <style>
    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicLight.ttf") format("truetype");
      font-weight: 300;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicBook.ttf") format("truetype");
      font-weight: 400;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicMedium.ttf") format("truetype");
      font-weight: 500;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicDemi.ttf") format("truetype");
      font-weight: 600;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicBold.ttf") format("truetype");
      font-weight: 700;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicExtraBold.ttf") format("truetype");
      font-weight: 800;
    }

    @font-face {
      font-family: "futura-pt";
      src: url("/fonts/FuturaCyrillicHeavy.ttf") format("truetype");
      font-weight: 900;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'futura-pt', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      justify-content: center;
      margin: 0;
      min-height: 100vh;
      color: #151515;
    }

    .app-background {
      position: fixed;
      inset: 0;
      z-index: -1;
      background: url("/images/bg-court-black.jpg") center / cover no-repeat;
      /* iOS stability tweaks */
      transform: translateZ(0);
      will-change: transform;
    }

    .app-wrapper {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100%;
      width: 100%;
      padding-top: max(24px, env(safe-area-inset-top));
      padding-bottom: max(24px, env(safe-area-inset-bottom));
    }

    .spacer-top {
      flex: 1;
    }

    .spacer-bottom {
      flex: 1;
      min-height: 24px;
    }

    .card {
      background: white;
      padding: 24px;
      border-radius: 32px;
      width: 100%;
      max-width: 396px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    h2 {
      margin: 0 0 16px;
      text-align: center;
    }

    h3 {
      text-align: center;
    }

    label {
      display: block;
      text-align: center;
      margin-bottom: 12px;
      font-size: 1rem;
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border-radius: 16px;
      border: 2px solid #1d1d1e;
      font-size: 18px;
    }

    input:focus,
    textarea:focus {
      outline: none;
      /* border-color: #4f46e5;
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2); */
    }

    #notesView {
      display: flex;
      flex-direction: column;
    }

    #notesView textarea {
      flex: 1;
      width: 100%;
      padding: 10px;
      margin: 0;
      border-radius: 11px;
      border: 2px solid #1d1d1e;
      font-size: 16px;
      font-family: 'futura-pt', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      resize: none;
      height: 100%;
    }

    button.submit-btn,
    .set-nav button,
    button.add-another-btn {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: #ff681d;
      color: #151515;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
    }

    button.submit-btn {
      visibility: hidden;
    }

    .set-nav button {
      background: #eaeaea;
      color: #151515;
      font-size: 16px;
      margin: 16px 0;

    }

    #prevBtn {
      visibility: hidden;
    }

    button.submit-btn:active,
    .set-nav button:active,
    button.add-another-btn:active {
      transform: scale(0.98);
    }

    button.submit-btn:hover,
    button.add-another-btn:hover {
      background: #cc5315;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      display: inline-block;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    #stats {
      position: relative;
    }

    #loadingOverlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 32px;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    #loadingOverlay .overlay-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: white;
      font-weight: 600;
      font-size: 18px;
      background: #000000;
      padding: 12px 24px;
    }

    .hidden {
      display: none !important;
    }

    .card {
      transition: opacity 0.2s ease;
    }




    /* Fade utility classes */
    .fade {
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      /* disable interaction while hidden */
    }

    .fade.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* iOS form control normalization */
    input[type="date"] {
      -webkit-appearance: none;
      appearance: none;
      background-color: #FFFFFF;
      text-align: center;
      font-family: 'futura-pt', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

    }

    /* iOS date input fixes */
    @supports (-webkit-touch-callout: none) {
      input[type="date"] {
        padding-right: 10px;
        text-align: center !important;
        color: #151515 !important;
        -webkit-text-fill-color: #151515;
      }
    }

    .sets-view {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      border: 2px solid #1d1d1e;
      border-radius: 16px;
      padding: 12px;
    }

    .shooting-percent-total {
      color: #1d1d1d;
      font-size: .9rem;
      margin-top: 0;
      margin-bottom: 12px;
      text-align: center;
    }

    .variation {
      border-radius: 8px;
      width: 100%;
    }

    .variation .title, .range-title, .range-current-date, .range-prior-date {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 1rem;
      text-align: center;
    }

    .range-current-date, .range-prior-date {
      color: #acacac;
      margin-bottom: 0;
    }

    .range-current-label, .range-prior-label {
      color: #acacac;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-align: center;
    }

    .variation .shooting-percent {
      color: #1d1d1d;
      font-size: .9rem;
      margin-top: 10px;
      text-align: center;
    }

    .grid {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn {
      width: 44px;
      height: 44px;
      border: 2px solid #151515;
      border-radius: 50%;
      background: url("/images/basketball-texture.jpg") center / cover no-repeat;
      cursor: pointer;
      font-size: 32px;
      line-height: 1;
      font-weight: 700;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    button.btn img {
      width: 20px;
      height: 20px;
    }

    .value {
      text-align: center;
      font-size: 48px;
      font-weight: 700;
      user-select: none;
    }

    .set-nav {
      display: grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 40px;
      width: 100%;
    }

    #thankYou p.confirmation {
      text-align: center;
      margin-top: 0;
      margin-bottom: 12px;
    }


    /* --- STAT CARD SECTION --- */

    /* Card */
    .stat-card, .graph-card {
      background: linear-gradient(#1a1a1a, #0f0f0f);
      border-radius: 16px;
      color: #ffffff;
      margin-bottom: 12px;
      padding: 12px;
      width: 100%;
    }

    .graph-card {
      margin-bottom: 0;
      padding: 0;
    }

    .graph-card.show {
      padding: 12px;
    }

    .stat-card_title, .graph-title {
      font-size: 24px;
      font-weight: 700;
      color: #acacac;
      margin-bottom: 8px;
      text-align: center;
    }

    .graph-title {
      font-size: 16px;
    }

    /* Rows */
    .stat-card_row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .stat-card_averages {
      justify-content: space-between;
    }

    /* Stat */
    .stat-card_stat {
      flex: 1;
      text-align: center;
      padding: 0 6px;
    }

    .stat-card_value {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.1;
    }

    .stat-card_value.session_value {
      font-size: 24px;
    }

    .stat-card_value.compare_value {
      font-size: 20px;
    }

    .stat-card_sub-value {
      margin-top: 4px;
    }

    .stat-card_label {
      font-size: 12px;
      letter-spacing: 0.08em;
      opacity: 0.7;
      margin-top: 4px;
    }

    .stat-card_session-description {
      font-style: italic;
      margin-top: 4px;
      text-align:center;
    }

    /* Dividers */
    .stat-card_divider {
      width: 1px;
      align-self: stretch;
      margin: 4px 0;
      background: #646464;
    }

    .stat-card_divider-hidden {
      width: 1px;
      align-self: stretch;
      margin: 4px 0;
      background: transparent;
    }

    .stat-card_divider-horizontal, .stat-card_divider-horizontal_under_label, .range_divider-horizontal, .range_divider-horizontal_under_label {
      width: 100%;
      height: 1px;
      margin: 4px 0 16px;
      background: #646464;
    }

    .stat-card_divider-horizontal_under_label, .range_divider-horizontal_under_label {
      margin-bottom: 4px;
    }

    .range_divider-horizontal, .range_divider-horizontal_under_label {
      background: #acacac;
    }

    .stat-card_current-label, .stat-card_prior-label, .stat-card_compare-label {
      font-size: 12px;
      letter-spacing: 0.08em;
      color: #646464;
      text-align: center;
    }

    /* Highlights */
    .highlight-red {
      color: #f6413c;
    }

    .highlight-yellow {
      color: #f5c400;
    }

    .highlight-green {
      color: #2ecc71;
    }

    .highlight-blue {
      color: #51BBFE;
    }

    .highlight-gray {
      color: #acacac;
    }

    /* To help make the showing of the Person dropdown smoother */
    .collapsible {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.5s ease, opacity 0.5s ease, margin-bottom 0.5s ease;
      margin: 0;
    }

    .collapsible.show {
      max-height: 248px;
      /* enough to show graph */
      opacity: 1;
      margin-top: 4px;
    }

    /* To make Show Set Detail stats on the Session Summary screen an accordion */
    .collapsible-container {
      margin-bottom: 12px;
      overflow: hidden;
    }

    .collapsible-header-container {
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      text-align: center;
    }

    .collapsible-heading {
      font-size: 28px;
      font-weight: 700;
    }

    .collapsible-instructions {
      color: #acacac;
      font-style: italic;
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.expanded {
    }

    /* --- SLIDER SECTION --- */
    /* Toggle wrappers */
    .mode-toggle-wrapper, .category-toggle-wrapper, .statDateRange-toggle-wrapper {
      display: block;          /* block-level helps iOS detect swipes */
      touch-action: pan-y;     /* vertical scrolling still works */
      -webkit-user-select: none;
      margin-bottom: 12px;
    }

    /* Toggle container */
    .mode-toggle, .category-toggle, .statDateRange-toggle {
      position: relative;
      margin: 0 auto;
      display: flex;
      background: #eaeaea;
      border-radius: 16px;
      user-select: none;
    }

    .mode-toggle {
      width: 50%;
    }

    .statDateRange-toggle {
      width: 100%;
    }

    /* Sliding pill */
    .toggle-pill {
      position: absolute;
      top: 4px;
      left: 4px;
      width: auto;
      height: calc(100% - 8px);
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
      transition: transform 0.25s ease;
      z-index: 1;
      /* to force hardware acceleration */
      transform: translateX(0) translateZ(0);
      will-change: transform;
    }


    .mode-toggle button, .statDateRange-toggle button {
      all: unset; /* remove all global button styles */
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px 0;
      cursor: pointer;
      font-weight: 600;
      color: #151515;
      user-select: none;
      z-index: 2;
      text-align: center;
      pointer-events: auto; /* ensure clicks work */
      border-radius: 16px; /* optional for pill look */
      -webkit-tap-highlight-color: transparent; /* remove blue tap highlight */
      touch-action: manipulation; /* improves tap responsiveness */
    }

    .mode-toggle button {
      flex-direction: column;
      gap: 4px;
    }

    .mode-toggle img {
      width: 14px;
    }

    .mode-toggle span {
      font-size: 12px;
      line-height: 1;
    }

    .statDateRange-toggle span {
      font-size: 12px;
    }
      
    /* Active state */
    .toggle-option.active {
      color: #151515;
    }

    .toggle-option:focus-visible {
      outline: 2px solid #4c6ef5;
      outline-offset: 2px;
    }

  </style>

</head>

<body>
  <!-- App wrapper contains card + logout button -->
  <div class="app-background"></div>
  <div class="app-wrapper">
    <div class="spacer-top"></div>

    <!-- Add transaction card -->
    <div class="card">
      <!-- Loading overlay -->
      <div id="loadingOverlay" class="hidden">
        <div class="overlay-content">
          <div class="spinner"></div>
          <div>Loading stats…</div>
        </div>
      </div>
      <!-- To slider: Mode -->
      <div id="modeToggleWrapper" class="mode-toggle-wrapper">
        <div class="mode-toggle" role="group" aria-label="Mode selector">
          <div class="toggle-pill"></div>
      
          <button type="button" class="toggle-option active" data-value="Input" data-index="0">
            <img src="images/input-icon.svg" alt="Input icon">
            <span>INPUT</span>
          </button>
      
          <button type="button" class="toggle-option" data-value="Stats" data-index="1">
            <img src="images/stat-icon.svg" alt="Stats icon">
            <span>STATS</span>
          </button>
        </div>
      </div>
      <div id="stats" class="hidden">

        <div class="range-title">TIME PERIOD</div>
        <!-- STAT TIME FRAME SLIDER -->
        <div id="statDateRangeWrapper" class="statDateRange-toggle-wrapper">
          <div class="statDateRange-toggle" role="group" aria-label="State date range selector">
            <div class="toggle-pill"></div>
            <button type="button" class="toggle-option active" data-value="1" data-index="0">1</button>
            <button type="button" class="toggle-option" data-value="7" data-index="1">7</button>
            <button type="button" class="toggle-option" data-value="30" data-index="2">30</button>
            <button type="button" class="toggle-option" data-value="90" data-index="3">90</button>
            <button type="button" class="toggle-option" data-value="180" data-index="4">180</button>
            <button type="button" class="toggle-option" data-value="365" data-index="5">365</button>
            <button type="button" class="toggle-option" data-value="All" data-index="6">ALL</button>
          </div>
        </div>

        <!-- CURRENT TIME PERIOD STATS CARD -->
        <div id="rangeTitle" class="range-title">LAST XXXX</div>
        <div id="rangeCurrentLabel" class="range-current-label collapsible">CURRENT</div>
        <div class="range_divider-horizontal_under_label"></div>
        <div id="rangeCurrentDate" class="range-current-date">XX/XX/XX</div>
        <div class="range_divider-horizontal"></div>
        <div id="rangePriorWrapper" class="collapsible">
          <div class="range-prior-label">PRIOR</div>
          <div class="range_divider-horizontal_under_label"></div>
          <div id="rangePriorDate" class="range-prior-date">XX/XX/XX</div>
          <div class="range_divider-horizontal"></div>
        </div>

        <!-- SETS CARD -->
        <div class="stat-card">
          <div class="stat-card_title">SETS</div>
          <div id="setsCurrentLabel" class="stat-card_current-label collapsible">CURRENT</div>
          <div class="stat-card_divider-horizontal_under_label"></div>

          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div id="setsCurrentValueR" class="stat-card_value session_value">XX</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="setsCurrentValueL" class="stat-card_value session_value">XX</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="setsCurrentValueT" class="stat-card_value session_value">XX</div>
            </div>
          </div>
          <div id="sessionsCurrentDesc" class="stat-card_session-description collapsible">Over XX sessions</div>
          <div class="stat-card_divider-horizontal"></div>

          <div id="setsPriorAndCompareWrapper" class="collapsible">
            <div class="stat-card_prior-label">PRIOR</div>
            <div class="stat-card_divider-horizontal_under_label"></div>

            <div class="stat-card_row stat-card_averages">
              <div class="stat-card_stat">
                <div id="setsPriorValueR" class="stat-card_value session_value">XX</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="setsPriorValueL" class="stat-card_value session_value">XX</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="setsPriorValueT" class="stat-card_value session_value">XX</div>
              </div>
            </div>
            <div id="sessionsPriorDesc" class="stat-card_session-description collapsible">Over XX sessions</div>
            <div class="stat-card_divider-horizontal"></div>

            <div class="stat-card_compare-label">COMPARE</div>
            <div class="stat-card_divider-horizontal_under_label"></div>

            <div class="stat-card_row stat-card_averages">
              <div class="stat-card_stat">
                <div id="setsCompareValueR" class="stat-card_value compare_value">XX</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="setsCompareValueL" class="stat-card_value compare_value">XX</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="setsCompareValueT" class="stat-card_value compare_value">XX</div>
              </div>
            </div>
            <div id="sessionsCompareDesc" class="stat-card_session-description collapsible">Over XX sessions</div>
            <div class="stat-card_divider-horizontal"></div>
          </div>


          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div class="stat-card_label">RIGHT</div>
            </div>
          
            <div class="stat-card_divider-hidden"></div>
          
            <div class="stat-card_stat">
              <div class="stat-card_label">LEFT</div>
            </div>
          
            <div class="stat-card_divider-hidden"></div>
          
            <div class="stat-card_stat">
              <div class="stat-card_label">TOTAL</div>
            </div>
          </div>

        </div>
        <!-- SHOOTING PERCENT CARD -->
        <div id="statShootingPercentCard" class="stat-card">
          <div class="stat-card_title">SHOOTING PCT</div>
          <div id="shootingPercentCurrentLabel" class="stat-card_current-label collapsible">CURRENT</div>
          <div class="stat-card_divider-horizontal_under_label"></div>

          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div id="shootingPercentCurrentValueR" class="stat-card_value session_value">XX%</div>
              <div id="shotsAndAttemptsCurrentValueR" class="stat-card_sub-value">XX/XX</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="shootingPercentCurrentValueL" class="stat-card_value session_value">XX%</div>
              <div id="shotsAndAttemptsCurrentValueL" class="stat-card_sub-value">XX/XX</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="shootingPercentCurrentValueT" class="stat-card_value session_value">XX%</div>
              <div id="shotsAndAttemptsCurrentValueT" class="stat-card_sub-value">XX/XX</div>
            </div>
          </div>
          <div class="stat-card_divider-horizontal"></div>
        
          <div id="shootingPercentPriorAndCompareWrapper" class="collapsible">
            <div class="stat-card_prior-label">PRIOR</div>
            <div class="stat-card_divider-horizontal_under_label"></div>

            <div class="stat-card_row stat-card_averages">
              <div class="stat-card_stat">
                <div id="shootingPercentPriorValueR" class="stat-card_value session_value">XX%</div>
                <div id="shotsAndAttemptsPriorValueR" class="stat-card_sub-value">XX/XX</div>
              </div>
          
              <div class="stat-card_divider"></div>
          
              <div class="stat-card_stat">
                <div id="shootingPercentPriorValueL" class="stat-card_value session_value">XX%</div>
                <div id="shotsAndAttemptsPriorValueL" class="stat-card_sub-value">XX/XX</div>
              </div>
          
              <div class="stat-card_divider"></div>
          
              <div class="stat-card_stat">
                <div id="shootingPercentPriorValueT" class="stat-card_value session_value">XX%</div>
                <div id="shotsAndAttemptsPriorValueT" class="stat-card_sub-value">XX/XX</div>
              </div>
            </div>
          
            <div class="stat-card_divider-horizontal"></div>
            <div class="stat-card_compare-label">COMPARE</div>
            <div class="stat-card_divider-horizontal_under_label"></div>

            <div class="stat-card_row stat-card_averages">
              <div class="stat-card_stat">
                <div id="shootingPercentCompareValueR" class="stat-card_value compare_value">XX%</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="shootingPercentCompareValueL" class="stat-card_value compare_value">XX%</div>
              </div>
            
              <div class="stat-card_divider"></div>
            
              <div class="stat-card_stat">
                <div id="shootingPercentCompareValueT" class="stat-card_value compare_value">XX%</div>
              </div>
            </div>
            
            <div class="stat-card_divider-horizontal"></div>
          </div>

        
          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div class="stat-card_label">RIGHT</div>
            </div>
        
            <div class="stat-card_divider-hidden"></div>
        
            <div class="stat-card_stat">
              <div class="stat-card_label">LEFT</div>
            </div>
        
            <div class="stat-card_divider-hidden"></div>
        
            <div class="stat-card_stat">
              <div class="stat-card_label">TOTAL</div>
            </div>
          </div>
        
        </div>
        <div id="graphWrapper" class="graph-card collapsible">
          <div id="graphTitle" class="graph-title">SHOOTING PCT OVER THE LAST XXX DAYS</div>
          <canvas id="myChart" width="100%"></canvas>
        </div>
        

      </div>



      <div id="shotForm">
        <label>
          SESSION DATE:
          <input type="date" name="date" required />
        </label>
        <!-- SET STATS CARD -->
        <div class="stat-card">
          <div id="setHeading" class="stat-card_title">SET</div>
          <div id="setStatCardRow" class="stat-card_row">
            <div class="stat-card_stat">
              <div id="setShotsAndAttempts" class="stat-card_value">XX/XX</div>
              <div class="stat-card_label">SHOTS</div>
            </div>

            <div class="stat-card_divider"></div>

            <div class="stat-card_stat">
              <div id="setShootingPercent" class="stat-card_value">XX%</div>
              <div class="stat-card_label">PCT</div>
            </div>
          </div>
        </div>

        <!-- SETS CONTAINER -->
        <div class="sets-view" id="setsView">
          <!-- Variation: Right -->
          <section class="variation" id="variationRight">
            <div class="title">Receiving from the RIGHT</div>
            <div class="grid" data-which="right">
              <button class="btn minus" id="minusRight" aria-label="Decrease right count"><img src="/images/minus.svg" alt="Minus icon""></button>
              <div class=" value" id="valueRight" aria-live="polite">0</div>
              <button class="btn plus" id="plusRight" aria-label="Increase right count"><img src="/images/plus.svg" alt="Plus icon""></button>
            </div>
            <div class=" shooting-percent" id="shootingPercentRight">XX%</div>
          </section>

          <!-- Variation: Left -->
          <section class="variation" id="variationLeft">
            <div class="title">Receiving from the LEFT</div>
            <div class="grid" data-which="left">
              <button class="btn minus" id="minusLeft" aria-label="Decrease left count"><img src="/images/minus.svg" alt="Minus icon""></button>
              <div class=" value" id="valueLeft" aria-live="polite">0</div>
              <button class="btn plus" id="plusLeft" aria-label="Increase left count"><img src="/images/plus.svg" alt="Plus icon""></button>
            </div>
            <div class=" shooting-percent" id="shootingPercentLeft">Shooting Percentage: XX%</div>
          </section>

        </div>

        <!-- Notes View (hidden by default) -->
        <div id="notesView" class="hidden">
          <textarea id="notesInput" placeholder="Add any notes about this session…"></textarea>
        </div>

        <!-- SET NAVIGATION BUTTONS -->
        <div class="set-nav">
          <button id="prevBtn">PREVIOUS</button>
          <button id="nextBtn">NEXT</button>
        </div>

        <!-- SESSION STATS CARD -->
        <div class="stat-card">
          <div class="stat-card_title">SESSION</div>
        
          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div id="sessionShootingPercentRight" class="stat-card_value session_value">XX%</div>
              <div id="sessionShotsAndAttemptsRight" class="stat-card_sub-value">XX/XX</div>
              <div class="stat-card_label">RIGHT</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="sessionShootingPercentLeft" class="stat-card_value session_value">XX%</div>
              <div id="sessionShotsAndAttemptsLeft" class="stat-card_sub-value">XX/XX</div>
              <div class="stat-card_label">LEFT</div>
            </div>
        
            <div class="stat-card_divider"></div>
        
            <div class="stat-card_stat">
              <div id="sessionShootingPercentTotal" class="stat-card_value session_value">XX%</div>
              <div id="sessionShotsAndAttemptsTotal" class="stat-card_sub-value">XX/XX</div>
              <div class="stat-card_label">TOTAL</div>
            </div>
          </div>
        </div>

        <button class="submit-btn" id="submitBtn">
          <span class="btn-text">SUBMIT</span>
          <span class="spinner hidden"></span>
        </button>
      </div>

      <div id="thankYou" class="hidden">
        <h2 id="submissionTitle">Nice work!</h2>
        <p class="confirmation">Your session has been saved.</p>
        <div id="summarySessionStats" class="summary-stats">Session stats will go here</div>
        <!-- Collapsible Set Stats -->
        <div class="collapsible-container">
          <div class="collapsible-header-container">
            <span class="arrow" style="visibility: hidden;">▼</span>
            <div>
              <div class="collapsible-heading">Set Stats</div>
              <div id="collapsibleInstructions" class="collapsible-instructions">(Click to expand)</div>
            </div>
            <span id="collapsibleArrow" class="arrow">▼</span>
          </div>
          <div id="summarySetStats" class="collapsible-content">
            <!-- Your dynamic set stats cards will go here -->
          </div>
        </div>
        <button class="add-another-btn" id="addAnother">ADD ANOTHER</button>
      </div>
    </div>

    <div class="spacer-bottom"></div>

  </div>
  <!-- <script type="module" src="script.js"></script> -->
  <script src="chart.js"></script>
  <script src="chartjs-adapter-date-fns.js"></script>
  <script type="module">
    // ----- Transaction form logic -----
    // State: 5 sets, each with right/left; currentSet 0..4
    const state = {
      date: "",
      sets: Array.from({ length: 5 }, () => ({ right: 0, left: 0 })),
      currentSet: 0,
      note: ""
    };

    let haveStats = false;
    const LOCAL_STORAGE_KEY = 'shotTrackerData';

    const modeToggleWrapper = document.getElementById("modeToggleWrapper");
    const form = document.getElementById("shotForm");
    const thankYou = document.getElementById("thankYou");
    const addAnother = document.getElementById("addAnother");
    const submitBtn = document.getElementById("submitBtn");
    const btnText = submitBtn.querySelector(".btn-text");
    const spinner = submitBtn.querySelector(".spinner");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const valueRight = document.getElementById('valueRight');
    const valueLeft = document.getElementById('valueLeft');
    const minusRight = document.getElementById('minusRight');
    const plusRight = document.getElementById('plusRight');
    const shootingPercentRight = document.getElementById('shootingPercentRight');
    const minusLeft = document.getElementById('minusLeft');
    const plusLeft = document.getElementById('plusLeft');
    const shootingPercentLeft = document.getElementById('shootingPercentLeft');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const setHeading = document.getElementById('setHeading');
    const setStatCardRow = document.getElementById('setStatCardRow');
    const setShotsAndAttempts = document.getElementById('setShotsAndAttempts');
    const setShootingPercent = document.getElementById('setShootingPercent');
    const sessionShootingPercentRight = document.getElementById('sessionShootingPercentRight');
    const sessionShootingPercentLeft = document.getElementById('sessionShootingPercentLeft');
    const sessionShootingPercentTotal = document.getElementById('sessionShootingPercentTotal');
    const sessionShotsAndAttemptsRight = document.getElementById('sessionShotsAndAttemptsRight');
    const sesssionShotsAndAttemptsLeft = document.getElementById('sesssionShotsAndAttemptsLeft');
    const sessionShotsAndAttemptsTotal = document.getElementById('sessionShotsAndAttemptsTotal');
    const setsView = document.getElementById('setsView');
    const notesView = document.getElementById('notesView');
    const notesInput = document.getElementById('notesInput');
    const dateInput = document.querySelector('input[name="date"]');
    const summarySessionStats = document.getElementById('summarySessionStats');
    const summarySetStats = document.getElementById('summarySetStats');
    const submissionTitle = document.getElementById('submissionTitle');
    const collapsibleHeaderContainer = document.querySelector('.collapsible-header-container');
    const collapsibleContent = document.querySelector('.collapsible-content');
    const collapsibleArrow = document.getElementById('collapsibleArrow');
    const collapsibleInstructions = document.getElementById('collapsibleInstructions');
    const stas = document.getElementById("stats");
    const rangeTitle = document.getElementById("rangeTitle");
    const rangeCurrentLabel = document.getElementById("rangeCurrentLabel");
    const rangeCurrentDate = document.getElementById("rangeCurrentDate");
    const rangePriorWrapper = document.getElementById("rangePriorWrapper");
    const rangePriorDate = document.getElementById("rangePriorDate");
    const setsCurrentLabel = document.getElementById("setsCurrentLabel");
    const setsCurrentValueR = document.getElementById("setsCurrentValueR");
    const setsCurrentValueL = document.getElementById("setsCurrentValueL");
    const setsCurrentValueT = document.getElementById("setsCurrentValueT");
    const sessionsCurrentDesc = document.getElementById("sessionsCurrentDesc");
    const setsPriorAndCompareWrapper = document.getElementById("setsPriorAndCompareWrapper");
    const setsPriorValueR = document.getElementById("setsPriorValueR");
    const setsPriorValueL = document.getElementById("setsPriorValueL");
    const setsPriorValueT = document.getElementById("setsPriorValueT");
    const sessionsPriorDesc = document.getElementById("sessionsPriorDesc");
    const setsCompareValueR = document.getElementById("setsCompareValueR");
    const setsCompareValueL = document.getElementById("setsCompareValueL");
    const setsCompareValueT = document.getElementById("setsCompareValueT");
    const sessionsCompareDesc = document.getElementById("sessionsCompareDesc");
    const statShootingPercentCard = document.getElementById("statShootingPercentCard");
    const shootingPercentCurrentLabel = document.getElementById("shootingPercentCurrentLabel");
    const shootingPercentCurrentValueR = document.getElementById("shootingPercentCurrentValueR");
    const shootingPercentCurrentValueL = document.getElementById("shootingPercentCurrentValueL");
    const shootingPercentCurrentValueT = document.getElementById("shootingPercentCurrentValueT");
    const shotsAndAttemptsCurrentValueR = document.getElementById("shotsAndAttemptsCurrentValueR");
    const shotsAndAttemptsCurrentValueL = document.getElementById("shotsAndAttemptsCurrentValueL");
    const shotsAndAttemptsCurrentValueT = document.getElementById("shotsAndAttemptsCurrentValueT");
    const shootingPercentPriorAndCompareWrapper = document.getElementById("shootingPercentPriorAndCompareWrapper");
    const shootingPercentPriorValueR = document.getElementById("shootingPercentPriorValueR");
    const shootingPercentPriorValueL = document.getElementById("shootingPercentPriorValueL");
    const shootingPercentPriorValueT = document.getElementById("shootingPercentPriorValueT");
    const shotsAndAttemptsPriorValueR = document.getElementById("shotsAndAttemptsPriorValueR");
    const shotsAndAttemptsPriorValueL = document.getElementById("shotsAndAttemptsPriorValueL");
    const shotsAndAttemptsPriorValueT = document.getElementById("shotsAndAttemptsPriorValueT");
    const shootingPercentCompareValueR = document.getElementById("shootingPercentCompareValueR");
    const shootingPercentCompareValueL = document.getElementById("shootingPercentCompareValueL");
    const shootingPercentCompareValueT = document.getElementById("shootingPercentCompareValueT");
    const graphWrapper = document.getElementById("graphWrapper");

    const SECRET_TOKEN = "oo04d@E5tXR3ie*8G&9$3SzHd79M0H";
    const scriptURL = "https://script.google.com/macros/s/AKfycbyvKYyNhZb3e7KftrOciXIKQFzogaFCyQQdKC1mUwoPUDqJ4t6mfBYZIoDhc7I4140e6g/exec"

    // Set date picker to default to today
    function setToday() {
      const today = new Date().toISOString().split("T")[0];
      dateInput.value = today;
    }

    // Render the values and button visibility for current set
    function renderSet(setIdx) {
      // Update values
      const s = state.sets[setIdx];
      valueRight.textContent = s.right;
      valueLeft.textContent = s.left;

      // Update minus/plus, shooting perctange visibility based on value
      minusRight.style.visibility = s.right > 0 ? 'visible' : 'hidden';
      plusRight.style.visibility = s.right < 99 ? 'visible' : 'hidden';
      shootingPercentRight.textContent = `${parseFloat((3 / s.right * 100).toFixed(1))}%`;
      shootingPercentRight.style.visibility = s.right > 0 ? 'visible' : 'hidden';

      minusLeft.style.visibility = s.left > 0 ? 'visible' : 'hidden';
      plusLeft.style.visibility = s.left < 99 ? 'visible' : 'hidden';
      shootingPercentLeft.textContent = `${parseFloat((3 / s.left * 100).toFixed(1))}%`;
      shootingPercentLeft.style.visibility = s.left > 0 ? 'visible' : 'hidden';

      // Calculate and display Set Shooting Perctnage
      if (s.right > 0 || s.left > 0) {
        const setRightMade = s.right > 0 ? 3 : 0;
        const setLeftMade = s.left > 0 ? 3 : 0;
        setShotsAndAttempts.textContent = `${setRightMade + setLeftMade}/${s.right + s.left}`;
        setShootingPercent.textContent = `${parseFloat(((setRightMade + setLeftMade) / (s.right + s.left) * 100).toFixed(1))}%`;
      } else {
        setShotsAndAttempts.textContent = "—";
        setShootingPercent.textContent = "—";
      }

      // Calculate and display Session Shooting Percentage and Attempts
      let sessionTotalAttemptsRight = 0;
      let sessionTotalAttemptsLeft = 0;
      let sessionTotalMakesRight = 0;
      let sessionTotalMakesLeft = 0;
      let sessionSetsCompletedRight = 0;
      let sessionSetsCompletedLeft = 0;

      state.sets.forEach(shot => {
        // Add attempts
        sessionTotalAttemptsRight += shot.right;
        sessionTotalAttemptsLeft += shot.left;

        // Add makes (3 points if value > 0)
        if (shot.right > 0) {
           sessionTotalMakesRight += 3;
           sessionSetsCompletedRight += 1;
        }
        if (shot.left > 0) {
          sessionTotalMakesLeft += 3;
          sessionSetsCompletedLeft += 1;
        }
      });

      calculateInsertAndColorCodeShootingPercentAndShotsSlashAttempts(sessionTotalAttemptsRight, sessionTotalMakesRight, sessionShootingPercentRight, sessionShotsAndAttemptsRight, "R");
      calculateInsertAndColorCodeShootingPercentAndShotsSlashAttempts(sessionTotalAttemptsLeft, sessionTotalMakesLeft, sessionShootingPercentLeft, sessionShotsAndAttemptsLeft, "L");
      calculateInsertAndColorCodeShootingPercentAndShotsSlashAttempts((sessionTotalAttemptsRight + sessionTotalAttemptsLeft), (sessionTotalMakesRight + sessionTotalMakesLeft), sessionShootingPercentTotal, sessionShotsAndAttemptsTotal, "T");
    }

    function calculateInsertAndColorCodeShootingPercentAndShotsSlashAttempts(attempts, makes, elementShootingPercent, elementShotsAndAttempts, whichRLT) {
      if (attempts > 0) {
        let shootingPercentValue = makes / attempts;
        elementShootingPercent.textContent = `${parseFloat((shootingPercentValue * 100).toFixed(1))}%`;
        elementShotsAndAttempts.textContent = `${makes}/${attempts}`;
      } else {
        elementShootingPercent.textContent = "—"
        elementShotsAndAttempts.textContent = "—"
      }

      colorCodeShooting({ attempts, makes, element: elementShootingPercent, whichRLT });
      colorCodeShooting({ attempts, makes, element: elementShotsAndAttempts, whichRLT });
    }

    function colorCodeShooting({ attempts, makes, element=null, whichRLT }) {
      const highlightClasses = [
        "highlight-red",
        "highlight-yellow",
        "highlight-green",
        "highlight-blue",
        "highlight-gray"
      ];

      if (element) element.classList.remove(...highlightClasses);

      if (!attempts || attempts <= 0) {
        return null;
      }

      const shootingPercentValue = makes / attempts;

      let classToApply = null;

      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_10_percentile${whichRLT}`]) {
        classToApply = highlightClasses[0];
      } else if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_25_percentile${whichRLT}`]) {
        classToApply = highlightClasses[1];
      } else if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_75_percentile${whichRLT}`]) {
        classToApply = null; // average (no highlight)
      } else if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_90_percentile${whichRLT}`]) {
        classToApply = highlightClasses[2];
      } else {
        classToApply = highlightClasses[3];
      }

      if (element && classToApply) {
        element.classList.add(classToApply);
      }
      
      return classToApply;
    }

    // Helpers to update a single value
    function updateValue(which, delta) {
      const idx = state.currentSet;
      const key = which; // 'right' or 'left'
      const old = state.sets[idx][key];
      let next = old + delta;
      if (next < 0) next = 0;
      if (next > 99) next = 99;
      state.sets[idx][key] = next;
      renderSet(idx);
    }

    // Prev/Next navigation
    function updateSetIndexUI() {
      if (state.currentSet === 5) {
        // Notes view
        setHeading.textContent = 'Notes';
        syncNotesHeight();
        setStatCardRow.style.visibility = 'hidden';
        setsView.classList.add('hidden');
        notesView.classList.remove('hidden');
        prevBtn.style.visibility = 'visible';
        nextBtn.style.visibility = 'hidden';
        submitBtn.style.visibility = 'visible';
      } else {
        // Set view (0-4)
        setHeading.textContent = `SET ${state.currentSet + 1} of 5`;
        setsView.classList.remove('hidden');
        notesView.classList.add('hidden');
        setStatCardRow.style.visibility = 'visible';

        // Show/hide prev button
        if (state.currentSet === 0) {
          prevBtn.style.visibility = 'hidden';
        } else {
          prevBtn.style.visibility = 'visible';
        }

        // Always show next button on sets
        nextBtn.style.visibility = 'visible';

        // Show submit on set 5, hide on others
        if (state.currentSet === 4) {
          submitBtn.style.visibility = 'visible';
        } else {
          submitBtn.style.visibility = 'hidden';
        }
      }
    }

    function syncNotesHeight() {
      const setsHeight = setsView.getBoundingClientRect().height;
      notesView.style.minHeight = `${setsHeight}px`;
    }

    // Initialize
    setToday();
    renderSet(state.currentSet);
    updateSetIndexUI();
    syncNotesHeight();

    // Attach event handlers
    plusRight.addEventListener('click', () => updateValue('right', state.sets[state.currentSet].right === 0 ? +3 : +1));
    minusRight.addEventListener('click', () => updateValue('right', state.sets[state.currentSet].right === 3 ? -3 : -1));
    plusLeft.addEventListener('click', () => updateValue('left', state.sets[state.currentSet].left === 0 ? +3 : +1));
    minusLeft.addEventListener('click', () => updateValue('left', state.sets[state.currentSet].left === 3 ? -3 : -1));

    prevBtn.addEventListener('click', () => {
      if (state.currentSet > 0) {
        // Save notes if leaving notes view
        if (state.currentSet === 5) {
          state.note = notesInput.value;
        }

        state.currentSet--;

        // Render set if going back to sets view
        if (state.currentSet < 5) {
          renderSet(state.currentSet);
        }

        updateSetIndexUI();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (state.currentSet < 5) {
        state.currentSet++;

        // If moving to notes view, populate textarea
        if (state.currentSet === 5) {
          notesInput.value = state.note;
        } else {
          renderSet(state.currentSet);
        }

        updateSetIndexUI();
      }
    });


    submitBtn.addEventListener("click", async () => {

      setLoading(true);

      try {
        state.date = dateInput.value;

        // Save notes before submitting
        if (state.currentSet === 5) {
          state.note = notesInput.value;
        }

        const payload = {
          token: SECRET_TOKEN,
          date: state.date,
          sets: [
            { "right": state.sets[0].right, "left": state.sets[0].left },
            { "right": state.sets[1].right, "left": state.sets[1].left },
            { "right": state.sets[2].right, "left": state.sets[2].left },
            { "right": state.sets[3].right, "left": state.sets[3].left },
            { "right": state.sets[4].right, "left": state.sets[4].left },
          ],
          note: state.note
        };

        await fetch(scriptURL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(payload)
        });

        modeToggleWrapper.classList.add("hidden");  
        form.classList.add("hidden");
        renderSummaryStats();
        thankYou.classList.remove("hidden");

        // Reset state after successful submit
        state.sets = Array.from({ length: 5 }, () => ({ right: 0, left: 0 }));
        state.currentSet = 0;
        state.note = "";
        notesInput.value = "";
        renderSet(0);
        updateSetIndexUI();
        setToday();
      } catch (err) {
        alert("Something went wrong. Try submitting again or check the console.");
        console.error(err);
      } finally {
        setLoading(false);
        getStatsFromGoogleSheet();        
      }
    });

    function setLoading(isLoading) {
      submitBtn.disabled = isLoading;
      btnText.classList.toggle("hidden", isLoading);
      spinner.classList.toggle("hidden", !isLoading);
    }

    function statsLoading(isLoading) {
      loadingOverlay.classList.toggle("hidden", !isLoading);
    }

    function renderSummaryStats() {
      // Calculate and display Session Shooting Percentage
      let sessionTotalAttemptsRight = 0;
      let sessionTotalAttemptsLeft = 0;
      let sessionTotalMakesRight = 0;
      let sessionTotalMakesLeft = 0;

      summarySessionStats.innerHTML = "";
      summarySetStats.innerHTML = "";

      // Example dummy sets
      const dummySets = [
        { right: 3, left: 4 },
        { right: 5, left: 6 },
        { right: 7, left: 8 },
        { right: 9, left: 10 },
        { right: 11, left: 12 }
      ];

      // state.sets.forEach((shot, index) => {
      state.sets.forEach((shot, index) => {
        // Add attempts
        sessionTotalAttemptsRight += shot.right;
        sessionTotalAttemptsLeft += shot.left;

        // Add makes (3 points if value > 0)
        if (shot.right > 0) sessionTotalMakesRight += 3;
        if (shot.left > 0) sessionTotalMakesLeft += 3;

        const setStatCardHTML = `
          <!-- SUMMARY SET STATS CARD -->
          <div class="stat-card">
            <div class="stat-card_title">SET ${index + 1} of 5</div>

            <div class="stat-card_row stat-card_averages">
              <div class="stat-card_stat">
                <div class="stat-card_value session_value">${shot.right > 0 ? `${parseFloat((3 / shot.right * 100).toFixed(1))}%` : "—" }</div>
                <div class="stat-card_sub-value">${shot.right > 0 ? `3/${shot.right}` : "—"}</div>
                <div class="stat-card_label">RIGHT</div>
              </div>

              <div class="stat-card_divider"></div>

              <div class="stat-card_stat">
                <div class="stat-card_value session_value">${shot.left > 0 ? `${parseFloat((3 / shot.left * 100).toFixed(1))}%` : "—" }</div>
                <div class="stat-card_sub-value">${shot.left > 0 ? `3/${shot.left}` : "—"}</div>
                <div class="stat-card_label">LEFT</div>
              </div>

              <div class="stat-card_divider"></div>

              <div class="stat-card_stat">
                <div id="sessionShootingPercentTotal" class="stat-card_value session_value">${(shot.right > 0 || shot.left > 0) ? `${parseFloat((((shot.right > 0 ? 3 : 0) + (shot.left > 0 ? 3 : 0)) / (shot.right + shot.left) * 100).toFixed(1))}%` : "—" }</div>
                <div id="sessionShotsAndAttemptsTotal" class="stat-card_sub-value">${(shot.right > 0 || shot.left > 0) ? `${(shot.right > 0 ? 3 : 0) + (shot.left > 0 ? 3 : 0)}/${shot.right + shot.left}` : "—" }</div>
                <div class="stat-card_label">TOTAL</div>
              </div>
            </div>
          </div>
        `;
        summarySetStats.innerHTML += setStatCardHTML;
      });

      const shootingPercentClassR = colorCodeShooting({ attempts: sessionTotalAttemptsRight, makes: sessionTotalMakesRight, whichRLT: "R" });
      const shootingPercentClassL = colorCodeShooting({ attempts: sessionTotalAttemptsLeft, makes: sessionTotalMakesLeft, whichRLT: "L" });
      const shootingPercentClassT = colorCodeShooting({ attempts: (sessionTotalAttemptsRight + sessionTotalAttemptsLeft), makes: (sessionTotalMakesRight + sessionTotalMakesLeft), whichRLT: "T" });

      submissionTitle.textContent = submissionMessage({ attempts: (sessionTotalAttemptsRight + sessionTotalAttemptsLeft), makes: (sessionTotalMakesRight + sessionTotalMakesLeft), whichRLT: "T" });

      const sessionStatCardHTML = `
        <!-- SUMMARY SET STATS CARD -->
        <div class="stat-card">
          <div class="stat-card_title">SESSION</div>

          <div class="stat-card_row stat-card_averages">
            <div class="stat-card_stat">
              <div class="stat-card_value session_value${shootingPercentClassR === null ? "" : ` ${shootingPercentClassR}`}">${sessionTotalAttemptsRight > 0 ? `${parseFloat((sessionTotalMakesRight / sessionTotalAttemptsRight * 100).toFixed(1))}%` : "—"}</div>
              <div class="stat-card_sub-value${shootingPercentClassR === null ? "" : ` ${shootingPercentClassR}`}">${sessionTotalAttemptsRight > 0 ? `${sessionTotalMakesRight}/${sessionTotalAttemptsRight}` : "—"}</div>
              <div class="stat-card_label">RIGHT</div>
            </div>

            <div class="stat-card_divider"></div>

            <div class="stat-card_stat">
              <div class="stat-card_value session_value${shootingPercentClassL === null ? "" : ` ${shootingPercentClassL}`}">${sessionTotalAttemptsLeft > 0 ? `${parseFloat((sessionTotalMakesLeft / sessionTotalAttemptsLeft * 100).toFixed(2))}%` : "—"}</div>
              <div class="stat-card_sub-value${shootingPercentClassL === null ? "" : ` ${shootingPercentClassL}`}">${sessionTotalAttemptsLeft > 0 ? `${sessionTotalMakesLeft}/${sessionTotalAttemptsLeft}` : "—"}</div>
              <div class="stat-card_label">LEFT</div>
            </div>

            <div class="stat-card_divider"></div>

            <div class="stat-card_stat">
              <div id="sessionShootingPercentTotal" class="stat-card_value session_value${shootingPercentClassT === null ? "" : ` ${shootingPercentClassT}`}">${(sessionTotalAttemptsRight > 0 || sessionTotalAttemptsLeft > 0) ? `${parseFloat(((sessionTotalMakesRight + sessionTotalMakesLeft) / (sessionTotalAttemptsRight + sessionTotalAttemptsLeft) * 100).toFixed(1))}%` : "—"}</div>
              <div id="sessionShotsAndAttemptsTotal" class="stat-card_sub-value${shootingPercentClassT === null ? "" : ` ${shootingPercentClassT}`}">${(sessionTotalAttemptsRight > 0 || sessionTotalAttemptsLeft > 0) ? `${sessionTotalMakesRight + sessionTotalMakesLeft}/${sessionTotalAttemptsRight + sessionTotalAttemptsLeft}` : "—"}</div>
              <div class="stat-card_label">TOTAL</div>
            </div>
          </div>
        </div>
      `;
      summarySessionStats.innerHTML += sessionStatCardHTML;
    }

    function submissionMessage({ attempts, makes, whichRLT }) {
      const noAttempts = [
        "No attempts today!",
        "Let's shoot some tomorrow!",
        "Let's get some reps in next time!"
      ];

      const veryPoor = [
        "Focus and shoot better!",
        "Step up your game!",
        "Eyes on the basket!",
        "Sharpen your form!",
        "Not your best, don't give up!",
        "Shooter keep shooting!"
      ];

      const poor = [
        "Push harder!",
        "Keep working on the fundamentals!",
        "Not enough consistency yet!",
        "Focus and take control!",
        "Work harder!"
      ];

      const averageLow = [
        "Keep improving every rep!",
        "Is average good enough?",
        "Decent, but you've got more!"
      ]

      const averageHigh = [
        "Solid, but you can do better!",
        "Good, but raise the bar!",
        "Consistent, but keep pushing!",
        "Nice work!",
      ];

      const great = [
        "Strong shooting!",
        "Excellent work!",
        "You’re hitting your stride!",
        "Impressive!",
        "Great work!"
      ];

      const elite = [
        "Precision shooting!",
        "Top-tier shooting!",
        "You’re on fire!",
        "Elite performance!",
        "Nearly perfect execution!",
        "One of your best!"
      ];

      if (!attempts || attempts <= 0) {
        return noAttempts[Math.floor(Math.random() * noAttempts.length)]
      }

      const shootingPercentValue = makes / attempts;

      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_10_percentile${whichRLT}`]) return veryPoor[Math.floor(Math.random() * veryPoor.length)];
      
      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_25_percentile${whichRLT}`]) return poor[Math.floor(Math.random() * poor.length)];
      
      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_50_percentile${whichRLT}`]) return averageLow[Math.floor(Math.random() * averageLow.length)];

      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_75_percentile${whichRLT}`]) return averageHigh[Math.floor(Math.random() * averageHigh.length)];

      if (shootingPercentValue < statsFromGoogleSheet[`shootingScoreCutoff_90_percentile${whichRLT}`]) return great[Math.floor(Math.random() * great.length)];
      
      if (shootingPercentValue >= statsFromGoogleSheet[`shootingScoreCutoff_90_percentile${whichRLT}`]) return elite[Math.floor(Math.random() * elite.length)];

      return "Nice work!";
    }

    collapsibleHeaderContainer.addEventListener('click', () => {
      collapsibleContent.classList.toggle('expanded');

      if (collapsibleContent.classList.contains('expanded')) {
        collapsibleContent.style.maxHeight = collapsibleContent.scrollHeight + "px";
        collapsibleArrow.textContent = "▲"; // Change arrow to up
        collapsibleInstructions.textContent = "(Click to collapse)"
      } else {
        collapsibleContent.style.maxHeight = "0";
        collapsibleArrow.textContent = "▼"; // Change arrow back down
        collapsibleInstructions.textContent = "(Click to expand)"
      }
    });

    addAnother.addEventListener("click", () => {
      thankYou.classList.add("hidden");
      form.classList.remove("hidden");
      modeToggleWrapper.classList.remove("hidden");  
      state.sets = Array.from({ length: 5 }, () => ({ right: 0, left: 0 }));
      state.currentSet = 0;
      state.note = "";
      notesInput.value = "";
      renderSet(0);
      updateSetIndexUI();
      setToday();
    });

    function previewThankYouCard() {
      // Hide mode slider
      modeToggleWrapper.classList.add("hidden");  
      // Hide the form
      form.classList.add("hidden");
      // Show thankYou
      thankYou.classList.remove("hidden");
      renderSummaryStats()

    }
    // previewThankYouCard();

    // code to eliminate double taps from zooming on iOS
    let lastTouchEnd = 0;

    document.addEventListener(
      'touchend',
      function (event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 200) {
          event.preventDefault();
        }
        lastTouchEnd = now;
      },
      { passive: false }
    );

    // --- GET STATS FROM GOOGLE SHEET ---
    let statsFromGoogleSheet = {};
    let allTimeDataFromGoogleSheet = [];
    let last365DataFromGoogleSheet = [];
    let currentMode = "Input";
    let currentStatRange = "1";

    async function getStatsFromGoogleSheet() {
      if (!haveStats && currentMode === "Stats") statsLoading(true);
      
      try {
        const response = await fetch(`${scriptURL}?token=${encodeURIComponent(SECRET_TOKEN)}`);
        const data = await response.json();

        if (data.success) {
          if (data.stats) {
            console.log("Stats from sheet:", data.stats);
            statsFromGoogleSheet = data.stats;
          }

          if (data.allTimeData) {
            console.log("All-Time Data from sheet:", data.allTimeData);
            allTimeDataFromGoogleSheet = data.allTimeData;
          }

          if (data.last365Data) {
            console.log("Last 365 Data from sheet:", data.last365Data);
            last365DataFromGoogleSheet = data.last365Data;
          }

          if (data.stats && data.allTimeData && data.last365Data) {
            saveToLocalStorage({
              stats: statsFromGoogleSheet,
              allTimeData: allTimeDataFromGoogleSheet,
              last365Data: last365DataFromGoogleSheet
            });
          }

        } 

      } catch (err) {
        console.error("Failed to load stats from Google Sheets:", err);
      } finally {
        if(!haveStats) {
          haveStats = true;
          if (currentMode === "Stats") statsLoading(false);
        }
        fillOutStats();
        console.log("loaded stats from google sheets");
      }
    }

    function loadFromLocalStorage() {
      const raw = localStorage.getItem(LOCAL_STORAGE_KEY);
      if (!raw) return null;
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("Failed to parse localStoreage data", e);
        return null;
      }      
    }

    function saveToLocalStorage({ stats, allTimeData, last365Data }) {
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ stats, allTimeData, last365Data }));
    }

    function initializeStats() {
      const cachedData = loadFromLocalStorage();
      if (cachedData && cachedData.stats && cachedData.allTimeData && cachedData.last365Data) {
        statsFromGoogleSheet = cachedData.stats;
        allTimeDataFromGoogleSheet = cachedData.allTimeData;
        last365DataFromGoogleSheet = cachedData.last365Data;
        haveStats = true;
        fillOutStats();
        console.log("loaded stats from cache");
      } else {
        console.log("stats were not able to be loaded from cache");
      }

      getStatsFromGoogleSheet();
    }

    initializeStats();

    import { Slider } from './slider.js';
    // ----- TOGGLE SECTION -----
    // Variables & Constants
    const statDateRangeWrapper = document.getElementById("statDateRangeWrapper");

    // Initialize sliders
    const modeSlider = new Slider({
      toggleEl: document.querySelector('.mode-toggle'),
      onActivate: (index, value) => {
        currentMode = value;
        showCurrentMode();
      }
    });

    const statDateRangeSlider = new Slider({
      toggleEl: document.querySelector('.statDateRange-toggle'),
      onActivate: (index, value) => {
        currentStatRange = value;
        fillOutStats();
      }
    });

    // Reconfigure category slider dynamically
    function showCurrentMode() {
      // wait one frame so layout is real
      requestAnimationFrame(() => {
        statDateRangeSlider.updatePillWidth();
      });

      if (currentMode === "Input") {
        form.classList.remove("hidden");
        stats.classList.add("hidden");
      }

      if (currentMode === "Stats") {
        form.classList.add("hidden");
        stats.classList.remove("hidden");
        if (!haveStats) {
          statsLoading(true);
        }
      }

    }

    function resetToggles() {
      modeSlider.activate(0, { animate: false }); // 0 = first button (Giving)
    }

    function fillOutStats() {
      let rangeStringForKey = "";

      switch (currentStatRange) {
        case "1":
          rangeTitle.textContent = "LAST SESSION";
          rangeStringForKey = "mostRecentSession";
          insertStatDate({ elementName: rangeCurrentDate, dateKey: `current_${rangeStringForKey}_startDate`, dateType: "singleDate" });
          insertStatDate({ elementName: rangePriorDate, dateKey: `prior_${rangeStringForKey}_startDate`, dateType: "singleDate" });
          sessionsCurrentDesc.classList.remove("show");
          sessionsPriorDesc.classList.remove("show");
          sessionsCompareDesc.classList.remove("show");
          statShootingPercentCard.style.marginBottom = "0";
          graphWrapper.classList.remove("show");
          break;
        
        case "All":
          rangeTitle.textContent = "ALL-TIME";
          rangeStringForKey = "allTime";
          statShootingPercentCard.style.marginBottom = "12px";
          sessionsCurrentDesc.classList.add("show");
          sessionsPriorDesc.classList.remove("show");
          sessionsCompareDesc.classList.remove("show");
          showPriorAndCompareForNonAllTime(false);
          break;

        default:
          rangeTitle.textContent = `LAST ${currentStatRange} DAYS`;
          rangeStringForKey = `${currentStatRange}days`;
          insertStatDate({ elementName: rangePriorDate, dateKey: `prior_${rangeStringForKey}_startDate`, dateKey2: `prior_${rangeStringForKey}_endDate`, dateType: "dateRange" });
          insertStatsValue({ baseElement: "sessionsPriorDesc", baseKey: `prior_${rangeStringForKey}_sessions`, statType: "sessionDesc", rlt: false });
          applyCompare({ baseName: "sessionsCompareDesc", baseKey: `compare_${rangeStringForKey}_sessions`, numberFormat: "int", compareType: "sessionDes", rlt: false });
          sessionsCurrentDesc.classList.add("show");
          sessionsPriorDesc.classList.add("show");
          sessionsCompareDesc.classList.add("show");
      }

      insertStatsValue({ baseElement: "setsCurrentValue", baseKey: `current_${rangeStringForKey}_setsCompleted` });
      insertStatsValue({ baseElement: "shootingPercentCurrentValue", baseKey: `current_${rangeStringForKey}_shootingPercent`, numberFormat: "oneDecimalPercent" });
      insertStatsValue({ baseElement: "shotsAndAttemptsCurrentValue", baseKey: `current_${rangeStringForKey}_setsCompleted`, numberFormat: "int", baseKey2: `current_${rangeStringForKey}_attempts`, statType: "makesSlashMisses" });
      
      

      if (currentStatRange !== "1") {
        insertStatDate({ elementName: rangeCurrentDate, dateKey: `current_${rangeStringForKey}_startDate`, dateKey2: `current_${rangeStringForKey}_endDate`, dateType: "dateRange" });
        insertStatsValue({ baseElement: "sessionsCurrentDesc", baseKey: `current_${rangeStringForKey}_sessions`, statType: "sessionDesc", rlt: false });

        // Setup Graph
        graphTitle.textContent = `SHOOTING PCT ${currentStatRange === "All" ? `ALL-TIME` : `OVER THE LAST ${currentStatRange} DAYS`}`;
        const rangeStartDate = new Date(statsFromGoogleSheet[`current_${rangeStringForKey}_startDate`]);
        const rangeEndDate = new Date(statsFromGoogleSheet[`current_${rangeStringForKey}_endDate`]);
        const totalDays = (rangeEndDate - rangeStartDate) / (1000 * 60 * 60 * 24) + 1;
        const approxTicks = 10;
        const step = Math.ceil(totalDays / approxTicks);
        const { dateLabels, shootingPcts } = filterDataForChart(rangeStartDate, rangeEndDate, (currentStatRange === "All" ? allTimeDataFromGoogleSheet : last365DataFromGoogleSheet));
        
        shootingChart.options.scales.x.time.stepSize = step;
        shootingChart.options.scales.x.ticks.maxTicksLimit = approxTicks;
        shootingChart.data.labels = dateLabels;
        shootingChart.data.datasets[0].data = shootingPcts;
        shootingChart.data.datasets[0].pointRadius = ((currentStatRange === "7" || currentStatRange === "30") ? 3 : 1);
        shootingChart.update();

        if (statsFromGoogleSheet[`current_${rangeStringForKey}_shootingPercentT`] !== "") {
          statShootingPercentCard.style.marginBottom = "12px";
          graphWrapper.classList.add("show");
        } else {
          statShootingPercentCard.style.marginBottom = "0";
          graphWrapper.classList.remove("show");
        }
      }

      if (currentStatRange !== "All") {
        insertStatsValue({ baseElement: "setsPriorValue", baseKey: `prior_${rangeStringForKey}_setsCompleted` });
        applyCompare({ baseName: "setsCompareValue", baseKey: `compare_${rangeStringForKey}_setsCompleted`, numberFormat: "int" });
        insertStatsValue({ baseElement: "shootingPercentPriorValue", baseKey: `prior_${rangeStringForKey}_shootingPercent`, numberFormat: "oneDecimalPercent" });
        insertStatsValue({ baseElement: "shotsAndAttemptsPriorValue", baseKey: `prior_${rangeStringForKey}_setsCompleted`, numberFormat: "int", baseKey2: `prior_${rangeStringForKey}_attempts`, statType: "makesSlashMisses" });
        applyCompare({ baseName: "shootingPercentCompareValue", baseKey: `compare_${rangeStringForKey}_shootingPercent`, numberFormat: "oneDecimalPercent" });
        showPriorAndCompareForNonAllTime(true);
      }
    }

    function insertStatDate({ elementName, dateKey, dateType = "dateRange", dateKey2 = "" }) {
      if (dateType === "singleDate") {
        elementName.textContent = new Date(statsFromGoogleSheet[dateKey]).toLocaleDateString("en-US", { timeZone: "UTC", month: "2-digit", day: "2-digit", year: "2-digit" });
      } else {
        elementName.textContent = `${new Date(statsFromGoogleSheet[dateKey]).toLocaleDateString("en-US", { timeZone: "UTC", month: "2-digit", day: "2-digit", year: "2-digit" })} — ${new Date(statsFromGoogleSheet[dateKey2]).toLocaleDateString("en-US", { timeZone: "UTC", month: "2-digit", day: "2-digit", year: "2-digit" })}`;
      }
    }

    function insertStatsValue({baseElement, baseKey, numberFormat = "int", statType = "singleNumber", baseKey2 = "", rlt = true }) {
      if (rlt) {
        const allThree = ["R", "L", "T"];
        allThree.forEach(pos => {
          const el = window[baseElement + pos];

          if (statType === "singleNumber") {
            if (numberFormat === "oneDecimalPercent") {
              el.textContent = `${parseFloat((statsFromGoogleSheet[baseKey + pos] * 100).toFixed(1))}%`;
            } else {
              el.textContent = statsFromGoogleSheet[baseKey + pos].toLocaleString("en-US", { maximumFractionDigits: 0 });
            }
          } else if (statType === "makesSlashMisses") {
            el.textContent = `${(statsFromGoogleSheet[baseKey + pos] * 3).toLocaleString("en-US", { maximumFractionDigits: 0 }) }/${statsFromGoogleSheet[baseKey2 + pos].toLocaleString("en-US", { maximumFractionDigits: 0 }) }`;
          }
        });
      } else {
        const el = window[baseElement];

        if (statType === "sessionDesc") {
          el.textContent = `across ${statsFromGoogleSheet[baseKey]} session${statsFromGoogleSheet[baseKey] === 1 ? "" : "s"}`;
        } else {
          el.textContent = statsFromGoogleSheet[baseKey];
        }
      }
    }

    function compareFormat({ compareKey, numberFormat, compareType = "" }) {
      let resultValue = statsFromGoogleSheet[compareKey];
      if (numberFormat === "oneDecimalPercent") {
        resultValue = parseFloat((statsFromGoogleSheet[compareKey] * 100).toFixed(1));
      } 

      if (compareType === "") {
        if (resultValue > 0) {
          return {
            text: `▲ ${numberFormat === "int" ? resultValue.toLocaleString("en-US", { maximumFractionDigits: 0 }) : resultValue}${numberFormat === "oneDecimalPercent" ? "%" : ""}`,
            className: "green"
          };
        } else if (resultValue === 0) {
          return {
            text: "—",
            className: "gray"
          };
        } else {
          return {
            text: `▼ ${Math.abs(numberFormat === "int" ? resultValue.toLocaleString("en-US", { maximumFractionDigits: 0 }) : resultValue)}${numberFormat === "oneDecimalPercent" ? "%" : ""}`,
            className: "red"
          };
        }
      } else if (compareType === "sessionDesc") {
        if (resultValue > 0) {
          return {
            text: `across ▲ ${numberFormat === "int" ? resultValue.toLocaleString("en-US", { maximumFractionDigits: 0 }) : resultValue} more session${resultValue === 1 ? "" : "s"}`,
            className: "green"
          };
        } else if (resultValue === 0) {
          return {
            text: "across the same number of sessions",
            className: "gray"
          };
        } else {
          return {
            text: `across ▼ ${Math.abs(numberFormat === "int" ? resultValue.toLocaleString("en-US", { maximumFractionDigits: 0 }) : resultValue)} less session${resultValue === 1 ? "" : "s"}`,
            className: "red"
          };
        }
      }
    }


    function applyCompare({baseName, baseKey, numberFormat = "int", compareType = "", rlt = true }) {
      if (rlt) {
        const allThree = ["R", "L", "T"];
        allThree.forEach(pos => {
          const { text, className } = compareFormat({ compareKey: baseKey + pos, numberFormat: numberFormat });
          const el = window[baseName + pos];
          el.textContent = text;
          el.classList.remove("highlight-green", "highlight-gray", "highlight-red")
          el.classList.add(`highlight-${className}`);
        });
      } else {
        const { text, className } = compareFormat({ compareKey: baseKey, numberFormat: numberFormat, compareType: "sessionDesc" });
        const el = window[baseName];
        el.textContent = text;
        el.classList.remove("highlight-green", "highlight-gray", "highlight-red")
        el.classList.add(`highlight-${className}`);
      }
    }

    function showPriorAndCompareForNonAllTime(shouldShow) {
      const elementsToToggle = [rangeCurrentLabel, rangePriorWrapper, setsCurrentLabel, setsPriorAndCompareWrapper, shootingPercentCurrentLabel, shootingPercentPriorAndCompareWrapper];
      elementsToToggle.forEach(el => {
        el.classList.toggle("show", shouldShow);
      })
    }



  const ctx = document.getElementById('myChart').getContext('2d');

  // Sample data
  const data = {
    labels: ['2026-01-01', '2026-01-02'],
    datasets: [{
      label: 'Shooting %',
      data: [0.5, 0.6],
      pointBackgroundColor: '#ff681d',
      pointBorderColor: '#ff681d',
      pointRadius: 3,
      borderColor: '#ff681d',  // line color
      backgroundColor: 'rgba(0,0,0,0)',
      tension: 0,
      spanGaps: true
    }]
  };

  const config = {
    type: 'line',
    data: data,
    options: {
      plugins: {
        legend: { display: false },
        title: { display: false },
        tooltip: {
          displayColors: false,
          callbacks: {
            title: context => {
              // context is an array of points being hovered
              const date = new Date(context[0].parsed.x);
              // Use only month/day/year
              return date.toLocaleDateString(undefined, {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
              });
            },
            label: context => {
              const value = context.raw;
              return `${(value * 100).toFixed(1)}%`;
            }
          }
        }
      },
      scales: {
        x: {
          type: 'time',        // date axis
          time: {
            unit: 'day',
            displayFormats: { day: 'MM/dd/yy'}
            // stepSize: 2
        },
          grid: { 
            color: '#acacac',
            drawBorder: true,
            drawOnChartArea: true,
            drawTicks: false
          },
          border: {
            display: true,
            color: '#ffffff',  // matches your y-axis line
            width: 1
          },
          ticks: {
            // maxTicksLimit: 30,
            color: '#ffffff',
            maxRotation: 60,
            minRotation: 60,
            font: {
              family: getComputedStyle(document.body).fontFamily,
              size: 10
            },
            padding: 6
          }
        },
        y: {
          min: 0,
          max: 1,
          ticks: {
            stepSize: 0.25,
            callback: value => `${(value * 100).toFixed(0)}%`,
            color: '#ffffff',
            font: {
              family: getComputedStyle(document.body).fontFamily,
              size: 10
            },
            padding: 8
          },
          grid: {
            color: '#acacac',
            drawBorder: true,
            drawOnChartArea: true,
            drawTicks: false,
          },
          border: {
            display: true,
            color: '#ffffff',  // matches your y-axis line
            width: 1
          }
        }
      }
    }
  };

  const shootingChart = new Chart(ctx, config);

  function filterDataForChart(startDate, endDate, whichData) {
    const start = startDate;
    const end = endDate;
    start.setUTCHours(0, 0, 0, 0);
    end.setUTCHours(23, 59, 59, 999);

    const filtered = whichData.filter(d => {
      const date = new Date(d.date);
      return date >= start && date <= end;
    });

    return {
      dateLabels: filtered.map(d => d.date),
      shootingPcts: filtered.map(d => d.shootingPct)
    };
  }

    // Example usage
    // const { labels, values } = filterData(new Date('2026-01-01'), new Date('2026-01-07'));
    // myChart.data.labels = labels;
    // myChart.data.datasets[0].data = values;
    // myChart.update();


</script></body>

</html>